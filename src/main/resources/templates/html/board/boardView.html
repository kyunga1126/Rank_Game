<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<title>EndGam - Gaming Magazine Template</title>
	<meta charset="UTF-8">
	<meta name="description" content="EndGam Gaming Magazine Template">
	<meta name="keywords" content="endGam,gGaming, magazine, html">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Favicon -->
	<link href="/img/favicon.ico" rel="shortcut icon"/>

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,500i,700,700i,900,900i" rel="stylesheet">


	<!-- Stylesheets -->
	<link rel="stylesheet" href="/css/bootstrap.min.css"/>
	<link rel="stylesheet" href="/css/font-awesome.min.css"/>
	<link rel="stylesheet" href="/css/slicknav.min.css"/>
	<link rel="stylesheet" href="/css/owl.carousel.min.css"/>
	<link rel="stylesheet" href="/css/magnific-popup.css"/>
	<link rel="stylesheet" href="/css/animate.css"/>

	<!-- Main Stylesheets -->
	<link rel="stylesheet" href="/css/style.css"/>


	<!--[if lt IE 9]>
	<script src="/https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="/https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

</head>
<body>
<!-- Page Preloder -->
<div id="preloder">
	<div class="loader"></div>
</div>

<!-- Header section -->
<header class="header-section">
	<div class="header-warp">
		<div class="header-social d-flex justify-content-end">
			<p>Follow us:</p>
			<a href="#"><i class="fa fa-pinterest"></i></a>
			<a href="#"><i class="fa fa-facebook"></i></a>
			<a href="#"><i class="fa fa-twitter"></i></a>
			<a href="#"><i class="fa fa-dribbble"></i></a>
			<a href="#"><i class="fa fa-behance"></i></a>
		</div>
		<div class="header-bar-warp d-flex">
			<!-- site logo -->
			<a href="/" class="site-logo">
				<img src="/img/logo.png" alt="Logo">
			</a>
			<nav class="top-nav-area w-100">
				<div class="user-panel">
					<div class="auth" th:if="${isLogin}">
						<a href="/profile/mainMyPage">ë§ˆì´í˜ì´ì§€</a> /
						<a href="/member/logout">ë¡œê·¸ì•„ì›ƒ</a>
					</div>
					<div class="auth" th:if="${!isLogin}">
						<a href="#" id="login-btn">ë¡œê·¸ì¸</a> / <a href="/member/signup">íšŒì›ê°€ì…</a>
					</div>
				</div>

				<div class="modal-overlay" id="modal-overlay" th:if="${!isLogin}"></div>

				<div class="modal" id="login-modal" th:if="${!isLogin}">
					<h2>ë¡œê·¸ì¸</h2>
					<form action="/member/login" method="post">
						<label for="login-email">ì´ë©”ì¼:</label>
						<input type="email" id="login-email" name="memberEmail" required>
						<label for="login-password">ë¹„ë°€ë²ˆí˜¸:</label>
						<input type="password" id="login-password" name="memberPassword" required>
						<button type="submit">ë¡œê·¸ì¸</button>
					</form>
					<button id="close-login-modal">ë‹«ê¸°</button>
					<button id="forgot-password-btn">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
				</div>

				<div class="modal" id="forgot-password-modal" th:if="${!isLogin}">
					<div class="modal-content" style="max-height: 70vh; overflow-y: auto;">
						<h3>ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h3>
						<form action="/member/resetPassword" method="POST" id="formId">
							<div class="mb-3">
								<label for="memberEmail">ì´ë©”ì¼</label>
								<div class="d-flex justify-content-between">
									<input type="email" name="memberEmail" id="memberEmail" placeholder="ê°€ì…í•˜ì‹  ì´ë©”ì¼ ì£¼ì†Œ" style="flex-grow: 1;">
									<button type="button" id="emailCheckBtn" class="btn btn-outline-dark mb-3 btn-sm" style="margin-left: 10px;">ì „ì†¡</button>
								</div>
								<div class="form-text" id="emailCheckWarn"></div>
							</div>
							<div class="mb-3">
								<label for="injeung">ì¸ì¦ë²ˆí˜¸ ì…ë ¥</label>
								<div class="d-flex justify-content-between">
									<input type="hidden" id="injeungbunho">
									<input type="text" id="injeung" style="flex-grow: 1;">
								</div>
								<div class="form-text" id="injeungCheckWarn"></div>
							</div>
							<button type="button" class="btn btn-dark mb-3" id="findPwdBtn" style="width: 100%;">í™•ì¸</button>
							<input type="hidden" id="randomPwd">
						</form>
						<button id="close-forgot-password-modal">ë‹«ê¸°</button>
					</div>
				</div>

				<!-- Menu -->
				<ul class="main-menu primary-menu">
					<li><a href="/">í™ˆ</a></li>
					<li><a href="/search/lol">ì „ì  ê²€ìƒ‰</a>
						<ul class="sub-menu">
							<li><a href="/search/lol">ë¦¬ê·¸ì˜¤ë¸Œë ˆì „ë“œ</a></li>
							<li><a href="/search/pubg">ë°°í‹€ê·¸ë¼ìš´ë“œ</a></li>
							<li><a href="/search/cyphers">ì‚¬ì´í¼ì¦ˆ</a></li>
						</ul>
					</li>
					<li><a href="/review">íˆ¬í‘œ / ê²Œì„ ë­í‚¹</a>
						<ul class="sub-menu">
							<li><a href="/review">ê²Œì„ ë­í‚¹</a></li>
							<li><a href="/vote">íˆ¬í‘œ</a></li>
						</ul>
					</li>
					<li><a href="/board">ììœ ê²Œì‹œíŒ</a></li>
					<li><a href="/notice">ê³µì§€ì‚¬í•­</a></li>
					<!-- ê´€ë¦¬ì í˜ì´ì§€ ë©”ë‰´ -->
					<li th:if="${isAdmin}">
						<a href="#">ê´€ë¦¬ì í˜ì´ì§€</a>
						<ul class="sub-menu">
							<li><a href="/admin/member">íšŒì›ê´€ë¦¬</a></li>
							<li><a href="/admin/notices">ê³µì§€ì‚¬í•­ ê´€ë¦¬</a></li>
							<li><a href="/admin/posts">ê²Œì‹œê¸€ ê´€ë¦¬</a></li>
						</ul>
					</li>
					<li th:if="${isManager}">
						<a href="#">ê´€ë¦¬ì í˜ì´ì§€</a>
						<ul class="sub-menu">
							<li><a href="/manager/members">íšŒì›ê´€ë¦¬</a></li>
							<li><a href="/admin/notices">ê³µì§€ì‚¬í•­ ê´€ë¦¬</a></li>
							<li><a href="/admin/posts">ê²Œì‹œê¸€ ê´€ë¦¬</a></li>
						</ul>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</header>
<!-- Header section end -->


	<!-- Page top section -->
<section class="page-top-section" style="background-image: url('/img/page-top-bg/4.jpg');">
		<div class="page-info">
			<h2>ê²Œì‹œê¸€</h2>
			<div class="site-breadcrumb">
				<a href="/">í™ˆ</a>  /
				<span>ìƒì„¸ë³´ê¸°</span>
			</div>
		</div>
	</section>
	<!-- Page top end-->

<!-- boardView-Section -->
<section class="boardView-section">
	<div class="boardView-container">
		<div class="boardView-header1">
			<h1 class="boardView-title" th:text="${board.title}">ì œëª©ì…ë‹ˆë‹¤.</h1>
		</div>
		<div class="boardView-header2">
			<div class="boardView-info1">
				ğŸ‘¤<span class="boardView-nickname" th:text="${board.nickname}">ë‹‰ë„¤ì„</span>&nbsp;
				ğŸ•˜<span class="boardView-date" th:text="${#temporals.format(board.createdAt, 'MM.dd')}"></span>&nbsp;
				ğŸ‘€<span class="boardView-viewCount" th:text="${board.viewCount}">0</span>&nbsp;
				â¤<span th:text="${board.likeCount}" class="boardView-likeCount"> 0</span>
			</div>
			<div class="boardView-menu-wrapper">
				<input type="checkbox" id="menu-toggle">
				<label for="menu-toggle" class="boardView-menu-btn">â‹®</label>
				<div class="boardView-menu-content">
					<ul>
						<li><a th:href="@{/board/modify/{id}(id=${board.id}, searchKeyword=${searchKeyword}, page=${page})}">âœï¸ìˆ˜ì •</a></li>
						<li><a href="#" class="delete-btn" th:data-id="${board.id}" th:data-search-keyword="${searchKeyword}" th:data-page="${page}">ğŸ—‘ï¸ì‚­ì œ</a></li>
<!--						<li><a href="#">ğŸš¨ì‹ ê³ </a></li>-->
<!--						<li><a href="#">ğŸš«ì°¨ë‹¨</a></li>-->
					</ul>
				</div>
			</div>
		</div>
		<hr class="boardView-separator">

		<div class="boardView-content-container">
			<p class="boardView-content" th:text="${board.content}" style="white-space: pre-wrap;">ë‚´ìš©ì´ ë“¤ì–´ê°ˆ ë¶€ë¶„ì…ë‹ˆë‹¤.</p>
			<div th:if="${imagePath != null}">
				<img th:src="${imagePath}" alt="Uploaded Image" />
			</div>

		</div>

		<div class="boardView-footer">
			<button id="likeBtn" class="likeButton" th:data-id="${board.id}">
				<span>ì¢‹ì•„ìš”</span>
				<span>ğŸ‘</span>
			</button>
			<button id="dislikeBtn" class="likeButton" th:data-id="${board.id}">
				<span>ì‹«ì–´ìš”</span>
				<span>ğŸ‘</span>
			</button>
		</div>

		<hr class="boardView-separator1">

		<div class="boardView-post-navigation">
			<!-- ì´ì „ ê¸€ ë²„íŠ¼ -->
			<form th:action="@{/board/view/{id}(id=${previousPost.id})}" method="get" class="navigation-form" th:if="${previousPost != null}">
				<button id="prevButton" class="prevButton"> << ì´ì „ ê¸€</button>
				<input type="hidden" name="searchKeyword" th:value="${searchKeyword}">
				<input type="hidden" name="page" th:value="${page}">
			</form>

			<!-- ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
			<form th:action="@{/board}" method="get" class="navigation-form">
				<button type="submit" class="prevButton">ëª©ë¡</button>
				<input type="hidden" name="searchKeyword" th:value="${searchKeyword}">
				<input type="hidden" name="page" th:value="${page}">
			</form>

			<!-- ë‹¤ìŒ ê¸€ ë²„íŠ¼ -->
			<form th:action="@{/board/view/{id}(id=${nextPost.id})}" method="get" class="navigation-form" th:if="${nextPost != null}">
				<button id="nextButton" class="prevButton">ë‹¤ìŒ ê¸€ >> </button>
				<input type="hidden" name="searchKeyword" th:value="${searchKeyword}">
				<input type="hidden" name="page" th:value="${page}">
			</form>
		</div>


		<div class="comment-title">ëŒ“ê¸€</div>
		<div class="comment-section">
			<ul id="commentList" class="comment-list">
				<!-- ëŒ“ê¸€ ëª©ë¡ì„ ë™ì ìœ¼ë¡œ ì¶”ê°€í•  ë¶€ë¶„ -->
			</ul>
			<div id="commentStatus" class="comment-status"></div>
		</div>

		<div class="comment-form-container">
			<form id="commentForm" class="comment-form">
				<input type="hidden" id="boardId" name="boardId" th:value="${board.id}" readonly>
				<input type="hidden" id="memberNum" name="memberNum" th:value="${memberNum}" readonly>
				<input name="content" id="content" class="comment-textarea" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required>
				<button type="submit" class="comment-submit-button">ëŒ“ê¸€ ì‘ì„±</button>
			</form>
		</div>
	</div>
</section>


<!-- Footer section -->
<footer class="footer-section">
	<div class="container">
		<div class="footer-left-pic">
			<img src="/img/footer-left-pic.png" alt="">
		</div>
		<div class="footer-right-pic">
			<img src="/img/footer-right-pic.png" alt="">
		</div>
		<a href="/" class="footer-logo">
			<img src="/img/logo.png" alt="">
		</a>
		<ul class="main-menu footer-menu">
			<li><a href="/">í™ˆ</a></li>
			<li><a href="/search/lol">ì „ì  ê²€ìƒ‰</a></li>
			<li><a href="/rank/review">ê²Œì„ ë­í‚¹</a></li>
			<li><a href="/boardList">ììœ ê²Œì‹œíŒ</a></li>
			<li><a href="/notice">ê³µì§€ì‚¬í•­</a></li>
		</ul>
		<div class="footer-social d-flex justify-content-center">
			<a href="#"><i class="fa fa-pinterest"></i></a>
			<a href="#"><i class="fa fa-facebook"></i></a>
			<a href="#"><i class="fa fa-twitter"></i></a>
			<a href="#"><i class="fa fa-dribbble"></i></a>
			<a href="#"><i class="fa fa-behance"></i></a>
		</div>
		<div class="copyright"><a href="">Colorlib</a> 2018 @ All rights reserved</div>
	</div>
</footer>
<!-- Footer section end -->


	<!--====== Javascripts & Jquery ======-->
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.slicknav.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/jquery.sticky-sidebar.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/main.js"></script>
<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script>
	$(document).ready(function() {
		const memberNum = $("#memberNum").val();
		const boardId = $("#boardId").val();

		// ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
		function loadComments() {
			$.ajax({
				type: "GET",
				url: "/comments/board/" + boardId,
				success: function(response) {
					$("#commentList").empty();
					response.forEach(function(comment) {
						// ë‚ ì§œ í¬ë§·íŒ…
						const createdAt = new Date(comment.createdAt);
						const formattedDate = createdAt.toLocaleDateString('ko-KR', {
							day: '2-digit',
							month: '2-digit'
						}).replace(/\//g, '.'); // ìŠ¬ë˜ì‹œë¥¼ ì ìœ¼ë¡œ ë³€í™˜

						let commentHtml =
								"<li data-id='" + comment.id + "'>" +
								"<div class='comment-header'>" +
								"<div class='comment-nickname'><strong>ğŸ‘¤ " + comment.nickname + "</strong>&nbsp; <em>ğŸ•˜ " + formattedDate + "</em></div>";

						if (comment.memberNum == memberNum) {
							commentHtml +=
									"<button class='comment-menu-btn'>â‹®</button>" +
									"<div class='comment-menu-options' style='display: none;'>" +
									"<button class='comment-edit-btn'>âœìˆ˜ì •</button>" +
									"<button class='comment-delete-btn'>ğŸ—‘ì‚­ì œ</button>" +
									"</div>";
						}

						commentHtml += "</div>" +
								"<div class='comment-content'>" + comment.content + "</div>" +
								"<div class='comment-edit-form' style='display: none;'>" +
								"<textarea class='comment-edit-text'>" + comment.content + "</textarea>" +
								"<button class='comment-save-btn'>ì €ì¥</button>" +
								"<button class='comment-cancel-btn'>ì·¨ì†Œ</button>" +
								"</div>" +
								"<hr class='comment-boardView-separator'></li>";

						$("#commentList").append(commentHtml);
					});

					// ë©”ë‰´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
					$('.comment-menu-btn').click(function() {
						const comment = $(this).closest('li');
						comment.find('.comment-menu-options').toggle();
					});

					// ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
					$('.comment-edit-btn').click(function() {
						const comment = $(this).closest('li');
						comment.find('.comment-edit-form').show();
						comment.find('.comment-content').hide();
						comment.find('.comment-menu-options').hide();
					});

					// ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
					$('.comment-cancel-btn').click(function() {
						const comment = $(this).closest('li');
						comment.find('.comment-edit-form').hide();
						comment.find('.comment-content').show();
					});

					// ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
					$('.comment-save-btn').click(function() {
						const comment = $(this).closest('li');
						const newText = comment.find('.comment-edit-text').val();
						const commentId = comment.data('id');

						$.ajax({
							type: "PUT",
							url: "/comments/" + commentId,
							contentType: "application/json",
							data: JSON.stringify({ content: newText }),
							success: function(response) {
								comment.find('.comment-content').text(newText);
								comment.find('.comment-edit-form').hide();
								comment.find('.comment-content').show();
							},
							error: function(xhr, status, error) {
								if (xhr.status === 401) {
									alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
									window.location.href = '/login'; // ì˜ˆì‹œ
								} else {
									console.error("ëŒ“ê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
								}
							}
						});
					});

					// ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
					$('.comment-delete-btn').click(function() {
						const commentId = $(this).closest('li').data('id');

						if (confirm("ì •ë§ë¡œ ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
							$.ajax({
								type: "DELETE",
								url: "/comments/" + commentId,
								success: function(response) {
									alert(response.message);
									loadComments(); // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
								},
								error: function(xhr, status, error) {
									if (xhr.status === 401) {
										alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
										window.location.href = '/login'; // ì˜ˆì‹œ
									} else {
										console.error("ëŒ“ê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
									}
								}
							});
						}
					});
				},
				error: function(xhr, status, error) {
					console.error("ëŒ“ê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
				}
			});
		}

		// í˜ì´ì§€ ë¡œë“œ ì‹œ ëŒ“ê¸€ ëª©ë¡ ë¡œë“œ
		loadComments();

		// ëŒ“ê¸€ ì²˜ë¦¬ í•¨ìˆ˜
		$("#commentForm").submit(function(event) {
			if (!memberNum) {
				alert("ë¡œê·¸ì¸ í›„ ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
				event.preventDefault();
				return false;
			}

			event.preventDefault();
			const formData = {
				boardId: $("#boardId").val(),
				memberNum: memberNum,
				content: $("#content").val()
			};

			$.ajax({
				type: "POST",
				url: "/comments",
				contentType: "application/json",
				data: JSON.stringify(formData),
				success: function(response) {
					$("#commentStatus").html("<p>" + response.message + "</p>");
					$("#content").val("");
					loadComments();
				},
				error: function(xhr, status, error) {
					$("#commentStatus").html("<p>ì˜¤ë¥˜: " + xhr.responseText + "</p>");
				}
			});
		})

		// ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		$(".delete-btn").click(function(event) {
			event.preventDefault(); // ê¸°ë³¸ ë§í¬ ë™ì‘ ë°©ì§€

			const button = $(this);
			const boardId = button.data("id");
			const searchKeyword = button.data("search-keyword");
			const page = button.data("page");

			// í™•ì¸ ëŒ€í™”ìƒì í‘œì‹œ
			if (confirm("ì •ë§ ì´ ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
				// ì‚¬ìš©ìê°€ í™•ì¸ì„ í´ë¦­í•˜ë©´ ì‚­ì œ ìš”ì²­ì„ ë³´ëƒ„
				const deleteUrl = `/board/delete/${boardId}?searchKeyword=${searchKeyword}&page=${page}`;
				window.location.href = deleteUrl;
			}
		});

		// ì¢‹ì•„ìš” ì‹«ì–´ìš” ë²„íŠ¼
		$('#likeBtn').click(function() {
			var boardId = $(this).data('id');  // th:data-idì—ì„œ ê°€ì ¸ì˜¨ board.id ê°’
			$.ajax({
				type: 'POST',
				url: '/board/like/' + boardId,
				success: function(response) {
					alert(response);  // ì„±ê³µ ì‹œ ì„œë²„ì˜ ì‘ë‹µ ë©”ì‹œì§€ë¥¼ ì•Œë¦¼ì°½ìœ¼ë¡œ í‘œì‹œ
					// ì¢‹ì•„ìš” ì„±ê³µ í›„ í˜ì´ì§€ì˜ UIë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
				},
				error: function(xhr) {
					alert(xhr.responseText);  // ì˜¤ë¥˜ ì‹œ ì„œë²„ì˜ ì‘ë‹µ ë©”ì‹œì§€ë¥¼ ì•Œë¦¼ì°½ìœ¼ë¡œ í‘œì‹œ
				}
			});
		});

		$('#dislikeBtn').click(function() {
			var boardId = $(this).data('id');  // th:data-idì—ì„œ ê°€ì ¸ì˜¨ board.id ê°’
			$.ajax({
				type: 'POST',
				url: '/board/dislike/' + boardId,
				success: function(response) {
					alert(response);  // ì„±ê³µ ì‹œ ì„œë²„ì˜ ì‘ë‹µ ë©”ì‹œì§€ë¥¼ ì•Œë¦¼ì°½ìœ¼ë¡œ í‘œì‹œ
					// ì‹«ì–´ìš” ì„±ê³µ í›„ í˜ì´ì§€ì˜ UIë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
				},
				error: function(xhr) {
					alert(xhr.responseText);  // ì˜¤ë¥˜ ì‹œ ì„œë²„ì˜ ì‘ë‹µ ë©”ì‹œì§€ë¥¼ ì•Œë¦¼ì°½ìœ¼ë¡œ í‘œì‹œ
				}
			});
		});
	});
</script>
	</body>
</html>
